<!DOCTYPE html>
<html>
<head>
  <title>eWAY Payment Form</title>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="https://secure.ewaypayments.com/scripts/eCrypt.min.js"></script>
  <link rel="icon" href="data:,">
</head>
<body>

  <h2>eWAY Payment Demo</h2>
  <div id="info"></div>

  <form>
    <label>Card Holder Name</label><br />
    <input type="text" id="card_name" placeholder="John Doe" required /><br /><br />

    <label>Card Number</label><br />
    <input type="text" id="card_number" placeholder="4444333322221111" required /><br /><br />

    <label>CVV</label><br />
    <input type="text" id="card_cvn" placeholder="123" required /><br /><br />

    <label>Expiry Month</label><br />
    <input type="text" id="expiry_month" placeholder="10" required /><br /><br />

    <label>Expiry Year</label><br />
    <input type="text" id="expiry_year" placeholder="26" required /><br /><br />

    <input type="button" id="submit" value="Make Payment" />
  </form>

  <script>
    $(document).ready(function () {
      $('#submit').click(function () {
        const cardName = $('#card_name').val();
        const cardNumber = $('#card_number').val();
        const cardCVN = $('#card_cvn').val();
        const expiryMonth = $('#expiry_month').val();
        const expiryYear = $('#expiry_year').val();

        if (!eCrypt.encryptValue) {
          alert('Encryption library not loaded.');
          return;
        }

        if (!cardNumber || !cardCVN || !cardName || !expiryMonth || !expiryYear) {
          alert('Please fill all card details.');
          return;
        }

        const encryptedCardData = {
          Number: eCrypt.encryptValue(cardNumber),
          CVN: eCrypt.encryptValue(cardCVN),
          ExpiryMonth: eCrypt.encryptValue(expiryMonth),
          ExpiryYear: eCrypt.encryptValue(expiryYear)
        };

        const payload = {
          userId: "686b5b63814e97b48c9f70bd",
          subscriptionPlanId: "6867e2d7814e97b48c9f4578",
          Customer: {
            FirstName: "Rishabh",
            LastName: "Sharma",
            Email: "rishabh.sharma@aayaninfotech.com",
            CardDetails: {
              Name: cardName,
              EncryptedCard: JSON.stringify(encryptedCardData)
            }
          },
          Payment: {
            TotalAmount: 50,  // 50 cents = $0.50 AUD
            CurrencyCode: "AUD"
          }
        };

        $.ajax({
          url: 'https://api.tradehunters.com.au/api/eway/pay',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(payload),
          success: function (data) {
            $('#info').html(`<pre>${JSON.stringify(data, null, 2)}</pre>`);
          },
          error: function (xhr) {
            $('#info').html('Error: ' + xhr.responseText);
          }
        });
      });
    });
  </script>

</body>
</html>
